<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Dashboard - Relatórios</title>
<style>
table { border-collapse: collapse; width: 100%; }
th, td { border: 1px solid #ddd; padding: 8px; font-family: Arial; font-size: 14px; }
th { background: #f3f3f3; }
.controls { margin-bottom: 12px; font-family: Arial; }
input { padding: 6px; margin-right: 8px; }
button { padding: 6px 10px; background: #056D73; color: #fff; border: none; border-radius: 4px; cursor: pointer; }
button:hover { background: #045860; }
</style>
</head>
<body>
<div class="controls">
  <label>De: <input type="date" id="from"></label>
  <label>Até: <input type="date" id="to"></label>
  <button onclick="carregar()">Carregar</button>
</div>
<table id="tbl">
  <thead>
    <tr>
      <th>Data/Hora</th>
      <th>Autor</th>
      <th>Presentes</th>
      <th>Faltas/Ausências</th>
      <th>% Inconformidade</th>
      <th>% Avarias</th>
      <th>Planilhamento</th>
      <th>1ª Expedição</th>
      <th>Pontos de Atenção</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
async function carregar() {
  const from = document.getElementById('from').value;
  const to = document.getElementById('to').value;
  const params = new URLSearchParams();
  if (from) params.set('from', from);
  if (to) params.set('to', to);

  try {
    const resp = await fetch('/api/relatorios?' + params.toString(), {
      headers: { 'x-api-key': 'coloque-um-segredo-forte-aqui' }
    });
    const rows = await resp.json();
    const tbody = document.querySelector('#tbl tbody');
    tbody.innerHTML = '';
    rows.forEach(r => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${new Date(r.criado_em).toLocaleString('pt-BR')}</td>
        <td>${r.autor || ''}</td>
        <td>${r.presentes ?? ''}</td>
        <td>${r.faltas || ''}</td>
        <td>${r.inconformidade ?? ''}</td>
        <td>${r.avarias ?? ''}</td>
        <td>${r.planilhamento ?? ''}</td>
        <td>${r.expedicao ?? ''}</td>
        <td>${(r.pontos || '').slice(0, 120)}${(r.pontos && r.pontos.length > 120) ? '...' : ''}</td>
      `;
      tbody.appendChild(tr);
    });
  } catch (e) {
    alert('Erro ao carregar: ' + e.message);
  }
}

// carrega automaticamente do dia
carregar();
</script>
</body>
</html>
