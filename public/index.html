<!DOCTYPE html>
<html lang='pt-BR'>
<head>
  <meta charset='UTF-8' />
  <meta name='viewport' content='width=device-width, initial-scale=1' />
  <title>Relatório Operacional Dinâmico (Responsivo + Auto-Fit)</title>
  <style>
    :root {
      --brand-primary: #AB4807;
      --brand-secondary: #056D73;
      --bg-body: #f9f9f9;
      --bg-card: #ffffff;
      --text-main: #000000;
      --text-muted: #999999;
      --border-soft: #dddddd;
      --border-form: #cccccc;
      --bg-attention: #fff3e0;
      --scale: 1; /* usado para o auto-fit via transform */
    }
    html { box-sizing: border-box; }
    *, *::before, *::after { box-sizing: inherit; }
    body {
      font-family: Arial, Helvetica, sans-serif;
      color: var(--text-main);
      margin: 0;
      background-color: var(--bg-body);
      line-height: 1.35;
    }

    .container {
      width: 100%;
      max-width: 960px;
      margin: 16px auto;
      background: var(--bg-card);
      border: 1px solid var(--border-soft);
      border-radius: 12px;
      padding: 12px clamp(12px, 3vw, 24px);
    }

    .header {
      text-align: center;
      border-bottom: 4px solid var(--brand-primary);
      padding-bottom: 8px;
      margin-bottom: clamp(12px, 3vw, 20px);
    }
    .header h2 {
      color: var(--brand-primary);
      font-size: clamp(18px, 2.3vw, 24px);
      margin: 0;
    }

    .section { margin-bottom: clamp(12px, 3vw, 22px); }
    .section h3 {
      font-size: clamp(16px, 2vw, 20px);
      margin-bottom: 8px;
      color: var(--brand-secondary);
    }
    ul { margin: 0; padding-left: clamp(14px, 3.5vw, 22px); }
    li { margin-bottom: 6px; font-size: clamp(14px, 1.9vw, 16px); }
    .highlight { font-weight: bold; color: var(--text-main); }

    .placeholder { color: var(--text-muted); font-style: italic; }

    .attention {
      background-color: var(--bg-attention);
      border-left: 6px solid var(--brand-primary);
      padding: clamp(8px, 2.3vw, 12px);
      border-radius: 8px;
      /* Em auto-fit vamos tentar mostrar todo o conteúdo, mas se exceder muito, mantém rolagem */
      max-height: none; /* remover limite fixo para tentar caber após compact + scale */
      overflow: hidden; /* sem barra, a ideia é caber na tela com scale */
    }
    .attention h3 { margin-top: 0; font-size: clamp(16px, 2vw, 20px); }
    .attention p { margin: 0; white-space: pre-wrap; overflow-wrap: break-word; word-break: break-word; font-size: clamp(14px, 1.9vw, 16px); }

    /* Formulário embutido (rolagem) */
    .form-container {
      margin-top: clamp(16px, 4vw, 24px);
      border: 1px solid var(--border-form);
      border-radius: 8px;
      padding: clamp(10px, 2.3vw, 14px);
      background-color: #f4f4f4;
    }
    .form-container h3 { margin: 0 0 8px 0; font-size: clamp(16px, 2vw, 20px); color: var(--brand-secondary); }

    .scroll-box { max-height: clamp(260px, 45vh, 420px); overflow-y: auto; padding-right: 8px; }

    form { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
    @media (max-width: 640px) { form { grid-template-columns: 1fr; } }

    .group-title { grid-column: 1 / -1; font-weight: bold; color: var(--brand-primary); margin-top: 10px; font-size: clamp(14px, 1.8vw, 16px); }

    input, textarea {
      padding: 8px;
      border: 1px solid var(--border-form);
      border-radius: 6px;
      width: 100%;
      font-size: clamp(14px, 1.8vw, 16px);
    }
    textarea { min-height: 90px; resize: vertical; }

    .char-counter { grid-column: 1 / -1; text-align: right; font-size: 12px; color: #666; margin-top: -4px; }

    .update-btn {
      grid-column: 1 / -1;
      padding: clamp(10px, 2.3vw, 12px);
      background-color: var(--brand-secondary);
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: clamp(14px, 1.9vw, 16px);
      margin-top: 8px;
    }
    .update-btn:hover { background-color: #045860; }

    /* --- Compact mode: reduz espaçamentos e cabeçalhos para tentar caber sem scroll --- */
    .compact .container { padding: 10px clamp(10px, 2.5vw, 20px); }
    .compact .header { padding-bottom: 6px; margin-bottom: clamp(10px, 2.5vw, 16px); }
    .compact .header h2 { font-size: clamp(16px, 2vw, 22px); }
    .compact .section { margin-bottom: clamp(10px, 2.5vw, 18px); }
    .compact .section h3 { font-size: clamp(14px, 1.8vw, 18px); margin-bottom: 6px; }
    .compact li { margin-bottom: 5px; font-size: clamp(13px, 1.7vw, 15px); }
    .compact .attention h3 { font-size: clamp(14px, 1.8vw, 18px); }
    .compact .attention p { font-size: clamp(13px, 1.7vw, 15px); }

    /* --- Visualização (título até o card) embrulhada para auto-fit via transform --- */
    .visualizacao-wrapper {
      position: relative;
      height: auto;
      overflow: hidden; /* evita barras quando o scale está ativo */
    }
    .visualizacao {
      transform: scale(var(--scale));
      transform-origin: top center;
    }
  </style>
</head>
<body>
  <div class='container'>
    <div class='visualizacao-wrapper'>
      <div class='visualizacao' id='visualizacao'>
        <div class='header'>
          <h2 id='titulo'>Overview Operacional - Qualidade (Dia Atual)</h2>
        </div>

        <!-- VISUALIZAÇÃO DO RELATÓRIO -->
        <div id='relatorio'>
          <!-- Absenteísmo -->
          <div class='section'>
            <h3>Absenteísmo</h3>
            <ul>
              <li><span class='highlight'>Presentes:</span> <span id='rPresentes' class='placeholder'>__</span> colaboradores</li>
              <li><span class='highlight'>Faltas/Ausências:</span> <span id='rFaltas' class='placeholder'>__</span></li>
            </ul>
          </div>

          <!-- Percentuais -->
          <div class='section'>
            <h3>Percentuais</h3>
            <ul>
              <li>% de Inconformidade da In Loco (Diário): <span id='rInconformidade' class='placeholder'>__</span></li>
              <li>% Avarias encontradas na Manipulação (Mensal): <span id='rAvarias' class='placeholder'>__</span></li>
            </ul>
          </div>

          <!-- Entrada -->
          <div class='section'>
            <h3>Entrada</h3>
            <ul>
              <li>Planilhamento: <span id='rPlanilhamento' class='placeholder'>__</span> peças</li>
              <li>1ª Expedição: <span id='rExpedicao' class='placeholder'>__</span> peças</li>
            </ul>
          </div>

          <!-- Produção / Produtividade -->
          <div class='section'>
            <h3>Produção / Produtividade</h3>
            <ul>
              <li>Planilhamento: HC: <span id='rHCPlan' class='placeholder'>__</span> | Meta: <span id='rMetaPlan' class='placeholder'>__</span> | Capacidade: <span id='rCapPlan' class='placeholder'>__</span></li>
              <li>In Loco: HC: <span id='rHCInLoco' class='placeholder'>__</span> | Meta: <span id='rMetaInLoco' class='placeholder'>__</span> | Capacidade: <span id='rCapInLoco' class='placeholder'>__</span></li>
              <li>Preventiva: HC: <span id='rHCPrev' class='placeholder'>__</span> | Meta: <span id='rMetaPrev' class='placeholder'>__</span> | Capacidade: <span id='rCapPrev' class='placeholder'>__</span></li>
              <li>1ª Expedição: HC: <span id='rHCExp' class='placeholder'>__</span> | Meta: <span id='rMetaExp' class='placeholder'>__</span> | Capacidade: <span id='rCapExp' class='placeholder'>__</span></li>
            </ul>
          </div>

          <!-- Backlog -->
          <div class='section'>
            <h3>Backlog</h3>
            <ul>
              <li>In Loco: Remessas pendentes inspeção: <span id='rRemInLoco' class='placeholder'>__</span> | Peças pendentes inspeção: <span id='rPecasInLoco' class='placeholder'>__</span></li>
              <li>Planilhamento: Remessas pendentes: <span id='rRemPlan' class='placeholder'>__</span> | Peças pendentes: <span id='rPecasPlan' class='placeholder'>__</span></li>
              <li>1ª Expedição: Peças pendentes: <span id='rPecasExp' class='placeholder'>__</span></li>
            </ul>
          </div>

          <!-- Pontos de Atenção -->
          <div class='attention'>
            <h3>Pontos de Atenção (Oportunidades / Ofensores / Pontos Críticos)</h3>
            <p id='rPontos' class='placeholder'>__</p>
          </div>
        </div>
      </div>
    </div>

    <!-- FORMULÁRIO EMBUTIDO (ROLAGEM) -->
    <div class='form-container'>
      <h3>Atualizar Dados</h3>
      <div class='scroll-box'>
        <form id='dataForm'>
          <div class='group-title'>Absenteísmo</div>
          <input type='number' id='presentes' placeholder='Presentes' />
          <input type='text' id='faltas' placeholder='Faltas/Ausências' />

          <div class='group-title'>Percentuais</div>
          <input type='number' id='inconformidade' placeholder='% Inconformidade In Loco' />
          <input type='number' id='avarias' placeholder='% Avarias' />

          <div class='group-title'>Entrada</div>
          <input type='number' id='planilhamento' placeholder='Planilhamento (peças)' />
          <input type='number' id='expedicao' placeholder='1ª Expedição (peças)' />

          <div class='group-title'>Produção / Produtividade</div>
          <input type='number' id='hcPlan' placeholder='HC Planilhamento' />
          <input type='number' id='metaPlan' placeholder='Meta Planilhamento' />
          <input type='number' id='capPlan' placeholder='Capacidade Planilhamento' />
          <input type='number' id='hcInLoco' placeholder='HC In Loco' />
          <input type='number' id='metaInLoco' placeholder='Meta In Loco' />
          <input type='number' id='capInLoco' placeholder='Capacidade In Loco' />
          <input type='number' id='hcPrev' placeholder='HC Preventiva' />
          <input type='number' id='metaPrev' placeholder='Meta Preventiva' />
          <input type='number' id='capPrev' placeholder='Capacidade Preventiva' />
          <input type='number' id='hcExp' placeholder='HC 1ª Expedição' />
          <input type='number' id='metaExp' placeholder='Meta 1ª Expedição' />
          <input type='number' id='capExp' placeholder='Capacidade 1ª Expedição' />

          <div class='group-title'>Backlog</div>
          <input type='number' id='remInLoco' placeholder='Remessas pendentes In Loco' />
          <input type='number' id='pecasInLoco' placeholder='Peças pendentes In Loco' />
          <input type='number' id='remPlan' placeholder='Remessas pendentes Planilhamento' />
          <input type='number' id='pecasPlan' placeholder='Peças pendentes Planilhamento' />
          <input type='number' id='pecasExp' placeholder='Peças pendentes 1ª Expedição' />

          <div class='group-title'>Pontos de Atenção</div>
          <textarea id='pontos' placeholder='Pontos de Atenção'></textarea>
          <div id='pontosCounter' class='char-counter'>0 / 600</div>
        </form>
      </div>
      <button class='update-btn' type='button' onclick='atualizarRelatorio()'>Atualizar</button>
    </div>
  </div>

  <script>
    const MAX_PONTOS = 600;

    function configurarLimitePontos(){
      const ta = document.getElementById('pontos');
      const counter = document.getElementById('pontosCounter');
      ta.setAttribute('maxlength', MAX_PONTOS);
      const atualizarContador = () => { counter.textContent = `${ta.value.length} / ${MAX_PONTOS}`; };
      ta.addEventListener('input', atualizarContador);
      atualizarContador();
    }

    function atualizarTitulo(){
      const titulo = document.getElementById('titulo');
      const agora = new Date();
      const dia = String(agora.getDate()).padStart(2, '0');
      const mes = String(agora.getMonth() + 1).padStart(2, '0');
      const ano = agora.getFullYear();
      const hora = String(agora.getHours()).padStart(2, '0');
      const minuto = String(agora.getMinutes()).padStart(2, '0');
      const dataHora = `${dia}/${mes}/${ano} - ${hora}:${minuto}`;
      titulo.innerText = `Overview Operacional - Qualidade (${dataHora})`;
    }

    // Placeholder sutil: usa "__" quando vazio, remove quando há valor
    function setTextSutil(id, valor){
      const el = document.getElementById(id);
      if (valor && valor.trim() !== '') {
        el.textContent = valor;
        el.classList.remove('placeholder');
      } else {
        el.textContent = '__';
        el.classList.add('placeholder');
      }
    }

    function atualizarRelatorio(){
      setTextSutil('rPresentes', document.getElementById('presentes').value);
      setTextSutil('rFaltas', document.getElementById('faltas').value);

      const incon = document.getElementById('inconformidade').value;
      setTextSutil('rInconformidade', incon ? (incon + '%') : '');

      const av = document.getElementById('avarias').value;
      setTextSutil('rAvarias', av ? (av + '%') : '');

      setTextSutil('rPlanilhamento', document.getElementById('planilhamento').value);
      setTextSutil('rExpedicao', document.getElementById('expedicao').value);

      setTextSutil('rHCPlan', document.getElementById('hcPlan').value);
      setTextSutil('rMetaPlan', document.getElementById('metaPlan').value);
      setTextSutil('rCapPlan', document.getElementById('capPlan').value);

      setTextSutil('rHCInLoco', document.getElementById('hcInLoco').value);
      setTextSutil('rMetaInLoco', document.getElementById('metaInLoco').value);
      setTextSutil('rCapInLoco', document.getElementById('capInLoco').value);

      setTextSutil('rHCPrev', document.getElementById('hcPrev').value);
      setTextSutil('rMetaPrev', document.getElementById('metaPrev').value);
      setTextSutil('rCapPrev', document.getElementById('capPrev').value);

      setTextSutil('rHCExp', document.getElementById('hcExp').value);
      setTextSutil('rMetaExp', document.getElementById('metaExp').value);
      setTextSutil('rCapExp', document.getElementById('capExp').value);

      setTextSutil('rRemInLoco', document.getElementById('remInLoco').value);
      setTextSutil('rPecasInLoco', document.getElementById('pecasInLoco').value);
      setTextSutil('rRemPlan', document.getElementById('remPlan').value);
      setTextSutil('rPecasPlan', document.getElementById('pecasPlan').value);
      setTextSutil('rPecasExp', document.getElementById('pecasExp').value);

      setTextSutil('rPontos', document.getElementById('pontos').value);

      // Após atualizar os dados, tentar auto-fit novamente
      requestAnimationFrame(autoFitVisualizacao);
    }

    // --- Auto-Fit: tenta mostrar do título até o card na viewport sem scroll do body ---
    function autoFitVisualizacao(){
      const root = document.documentElement;
      const wrap = document.querySelector('.visualizacao-wrapper');
      const vis = document.getElementById('visualizacao');

      // Reset para medir corretamente
      root.style.setProperty('--scale', 1);
      document.body.classList.add('compact');

      const viewportH = window.innerHeight;
      const visRect = vis.getBoundingClientRect();
      const fullH = vis.scrollHeight; // altura total do conteúdo

      // Margem mínima interna
      const padding = 16; // px
      let target = viewportH - padding;

      // Se ainda não couber em modo compacto, aplicar scale progressivo
      let scale = 1;
      if (fullH > target) {
        scale = target / fullH; // primeira estimativa
        // Limita para não ficar ilegível
        if (scale < 0.75) scale = 0.75;
      }
      root.style.setProperty('--scale', scale);

      // Se com compacto + scale ainda vazar, remove compacto para evitar quebra de layout
      // (em alguns casos, reduzir line-height demais pode cortar conteúdo)
      const afterH = vis.scrollHeight * scale;
      if (afterH > viewportH) {
        document.body.classList.remove('compact');
      }
    }

    // Inicializações
    configurarLimitePontos();
    atualizarTitulo();
    setInterval(atualizarTitulo, 60000);

    window.addEventListener('load', autoFitVisualizacao);
    window.addEventListener('resize', autoFitVisualizacao);
  </script>
</body>
  </html>
